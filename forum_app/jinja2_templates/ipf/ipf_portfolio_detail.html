{% extends "_layouts/_home.html" %}
{% set ID, NAME = 0, 1
%}
{% block title %}IPF{% endblock %}

{% block content %}

<div class="page-content">

  <div class="container">

    
    <p>There are no portfolios.</p>

    <p>
      <button data-target="add_portfolio_modal" class="btn modal-trigger">
        <i class="material-icons left">add</i>Add portfolio
      </button>
    </p>


  </div><!-- end-of-container -->

</div><!-- end-of-page-content -->

 <div id="add_portfolio_modal" class="modal modal-fixed-footer">
   <div class="modal-content container">
    <div class="row">

      <h4>Add portfolio</h4>
      
      <div class="input-field col s6">
        <input id="portfolio_name" type="text" class="validate">
        <label for="portfolio_name">Portfolio Name</label>
      </div>

    </div>
   </div>

   <div class="modal-footer">
    <span id="operationStatusText" class="left btn-flat" style="cursor:unset">Unsaved</span>
    
    <button class="modal-close waves-effect waves-red btn">
      <i class="material-icons left">close</i>Cancel
    </button>
    <button class="waves-effect waves-green btn" id="addPortfolioButton">
      <i class="material-icons left">add</i>Add portfolio
    </button>

   </div>
 </div>

<div class="fixed-action-btn">
  <a class="btn-floating btn-large indigo darken-4">
    <i class="large material-icons">mode_edit</i>
  </a>
  <ul>
    <li><a class="btn-floating red"><i class="material-icons">insert_chart</i></a></li>
    <li><a class="btn-floating yellow darken-1"><i class="material-icons">format_quote</i></a></li>
    <li><a class="btn-floating green"><i class="material-icons">publish</i></a></li>
    <li><a class="btn-floating blue"><i class="material-icons">attach_file</i></a></li>
  </ul>
</div>

{% endblock %}

{% block scripts %}

<script type="text/javascript">
  "use strict";
  var floatingActionButtons
      , modals
      , addPortfolioButton = document.getElementById("addPortfolioButton")
      , operationStatusText = document.getElementById("operationStatusText")
      , portfolio_name_field = document.getElementById("portfolio_name")
      ;
  
  const pg = {
    state : 'INIT'
  };

  function addPortfolioAction(e) {
    var postData = JSON.stringify({
      'action': 'add-portfolio',
      'portfolio_name' : portfolio_name_field.value
    });

    fetch('/api/ipf/portfolio', {
      method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: postData
    })
    .then(function(response) {
      operationStatusText.innerText = response.status;
      return response.json();
    })
    .then(function(data) {
      //document.getElementById('app_content').innerHTML = data;
      // Update state
      // window.history.pushState(state, null, "");
      //M.toast({html: 'OK', classes: 'green'});
      // data['location_type']
      // var selected_location_type = document.getElementById('selected_location_type')
      // selected_location_type.innerText = data['location_type'];
      console.log(data);
      // Update operationStatusText; 
      operationStatusText.innerText = data.result;
    })
    .catch(function(e) {
      console.error(e);
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    floatingActionButtons = M.FloatingActionButton.init(
      document.querySelectorAll('.fixed-action-btn')
    );
    
    modals = M.Modal.init(document.querySelectorAll('.modal'), {
      'onOpenStart' : function () {
        portfolio_name_field.value = "";
      }
    });

    addPortfolioButton.addEventListener("click", addPortfolioAction);
    
  });

</script>

{% endblock %}